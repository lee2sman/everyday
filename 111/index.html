<html  dir="auto" >
<head>
  <title>my reward</title>
<link rel="icon" 
      type="image/png" 
      href="favicon.png">
<style>
	body {
		margin:40px;
		padding:40px;
	}
</style>
  <link rel="stylesheet" href="style.css">
<script>

var embedDat = "%7B%22START%22:%5B%5B%22night%20begins%20or%20ends%20or%20its%20late%20anyway%20late%20enough%22%5D,%5B%22%22%5D,%5B%22people%20mumbling%20stuff%20at%20each%20other%20it's%20hot%20now%20the%20heats%20up%20the%20tables%20got%20a%20few%20cups%20on%20it%20empty%20beer%20glasses%20coffee%20or%20tea%20cup%20theres%20dishes%20in%20the%20sink%20theyre%20carrying%20on%20back%20and%20forth%20not%20too%20bad%20just%20a%20little%20hubbub%20barely%20the%20lights%20on%20too%20bright%20turn%20it%22%5D,%5B%22down%22,%22RIGHT%22%5D,%5B%22%22%5D,%5B%22the%20kitchens%20a%20mess%20leave%20it%20but%20the%20beds%20just%20right%20here%20in%20this%22%5D,%5B%22room%22,%22ROOM%22%5D,%5B%22%22%5D%5D,%22__STARTSECTION__%22:%22START%22,%22DOWN%22:%5B%5B%22just%20shuddup%20half%20dead%20dishes%20they%20should%20be%20cleaned%20theyre%20looking%20at%20us%20just%20turn%20your%20back%20dont%20whatever%20who%20cares%20its%20time%20its%20time%20thats%20what%20she%20said%20ok%20im%20giving%20up%20i%20dont%20care%20to%20guess%20not%22%5D,%5B%22important%22,%22YELLING%22%5D,%5B%22%22%5D%5D,%22ROOM%22:%5B%5B%22yeah%20its%20not%20too%20big%20it's%20one%20big%20full%20of%20us%20and%20we're%20in%20the%20middle%20and%20you%20gotta%20like%20each%20other%20to%20survive%20that%20to%20make%20it%20through%20its%20just%20one%20big%20mess%20you%20blow%20your%20nose%20not%20sick%20just%20permanently%20like%20that%20were%20good%20were%20okay%20just%20keeping%20it%20going%20doing%20my%20job%20i%20fix%20things%20i%20work%20i%20take%20care%20of%20the%20stuff%20i%20cut%20things%20with%20the%20chopsaw%20i%20put%20pieces%20back%20on%20the%20roof%20the%20right%20pieces%20i%20take%20a%20break%20and%20drive%20my%20truck%20and%20do%20whatever%20i%20want%20and%20i%20get%20back%20to%20it%20and%20at%20the%20end%20of%20the%20day%20i%20drink%20a%20drink%20and%20play%20my%20tv%20and%20watch%20whatever%20i%20want%20on%20netflix%20at%20whatever%20volume%20i%20want%20and%20thats%20right%20and%20good%20and%20i%20do%20that%20til%20i%20go%20to%20bed%20carrying%20on%20getting%20to%20sleep%20thats%22%5D,%5B%22right%22,%22RIGHT%22%5D,%5B%22%22%5D%5D,%22RIGHT%22:%5B%5B%22i%20turn%20off%20the%20light%20and%20god%20puts%20me%20to%20sleep%20and%20i%20dream%20about%20riches%20and%20my%20truck%20and%20a%20dog%20running%20and%20its%20running%20a%20long%20time%20a%20time%20for%20everything%20theres%20no%20problems%20i%20have%20everything%20i%20want%20a%20ring%20my%20uncle%20joseph%20some%20bars%20of%20gold%20a%20giant%20flatscreen%20tv%20an%20old%20camaro%20a%20giant%20house%20with%204%20bathrooms%20maybe%205%20you%20can%20walk%20into%20the%20closet%20and%20my%20ladys%20got%20one%20of%20them%20walkins%20ones%20and%20shes%20walking%20around%20and%20falling%20through%20the%20closet%20floor%20into%20the%20chute%20down%20and%20i%20turn%20around%20my%20head%20is%20slow%20fuzzy%20theres%20the%20man%20who%20and%20then%20just%20then%20i%20wake%20up%20and%20gods%20opened%20my%20eyes%20the%20chickens%20are%20chirping%20the%20sun%20is%20brighting%20the%20world%20is%20up%20and%20we%20are%20all%20up%20and%20its%20up%20for%20good%20its%20good%20to%20be%20up%20early%20its%20healthy%20and%20im%20a%20good%20person%20for%20getting%20up%20this%20early%20the%20time%20that%20the%20world%20wants%20me%20to%22%5D,%5B%22up%22,%22UP%22%5D,%5B%22%22%5D%5D,%22UP%22:%5B%5B%22and%20im%20going%20to%20work%20working%20im%20working%20on%20the%20things%20i%20need%20everybody%20needs%20these%20are%20the%20things%20i%20need%20wood%20i%20need%20bricks%20i%20need%20nails%20and%20hammers%20i%20need%20a%20desk%20or%20papers%20or%20a%20phone%20my%20phone%20i%20need%20my%20phone%20and%20im%20on%20the%20phone%20and%20i%20listen%20to%20the%20radio%20and%20wearing%20eyegoggles%20nope%20no%20a%20mask%20im%20wearing%20a%20mask%20and%20i%20have%20my%20phone%20i%20said%20i%20have%20it%20and%20im%20working%20sawing%20doing%20something%20what%20im%20not%20sure%20i%20guess%20cutting%20it%20and%20its%20cut%20and%20im%20finished%20im%20really%20done%20and%20can%20go%20to%20the%22%5D,%5B%22tv%22,%22TV%22%5D,%5B%22%22%5D%5D,%22TV%22:%5B%5B%22my%20reward%22%5D,%5B%22end%22,%22START%22%5D,%5B%22%22%5D%5D%7D";

var gameState = null;


var aurl = document.createElement('a');
function qualifyURL(url) {
 aurl.href = url;
 return aurl.href;
}

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

function strip_http(url) {
   url = url.replace(/^https?:\/\//,'');
   return url;
}

function startSection(){
  if (gameState==null){
    return "";
  }
  var param = getParameterByName("section");

  var result = "__STARTSECTION__" in gameState ? gameState["__STARTSECTION__"] : "START";
  if (param.length>0){
    result=param;
  }

  return result;
}

function init(){
	if (embedDat.length>0 && embedDat[0]!=='_'){
		var dat = decodeURI(embedDat);
		gameState = JSON.parse(dat);
    var startKey = startSection();
		goTo(startKey);
		return;
	}

var id = getParameterByName("p").replace(/[\\\/]/,"");
  if (id===null||id.length===0) {
    console.log("No ID specified in URL.")
    return;
  }

  var githubURL = 'https://api.github.com/gists/'+id;

  var githubHTTPClient = new XMLHttpRequest();
  githubHTTPClient.open('GET', githubURL);
  githubHTTPClient.onreadystatechange = function() {
    if(githubHTTPClient.readyState!=4) {
      return;
    }   
    var result = JSON.parse(githubHTTPClient.responseText);
    if (githubHTTPClient.status===403) {
      console.log(result.message);
    } else if (githubHTTPClient.status!==200&&githubHTTPClient.status!==201) {
      console.log("HTTP Error "+ githubHTTPClient.status + ' - ' + githubHTTPClient.statusText);
    }
    var result = JSON.parse(githubHTTPClient.responseText);
    var code=result["files"]["game.txt"]["content"];
    console.log(code);

	gameState = JSON.parse(code);
	goTo(startSection());
  }
  githubHTTPClient.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  githubHTTPClient.send();

	goTo(startSection());
}	

function escapeHtmlEntities (str) {
  if (typeof jQuery !== 'undefined') {
    // Create an empty div to use as a container,
    // then put the raw text in and get the HTML
    // equivalent out.
    return jQuery('<div/>').text(str).html();
  }

  // No jQuery, so use string replace.
  return str
    .replace(/&/g, '&amp;')
    .replace(/>/g, '&gt;')
    .replace(/</g, '&lt;')
    .replace(/"/g, '&quot;');
}

function goTo(targetState){
  if (gameState==null){
    return;
  }
	var curstate = gameState[targetState];
	var gameArea = document.getElementById("gameArea");
	var str = "";
	for (var i=0;i<curstate.length;i++){
		var l = curstate[i];
		if (l.length==1){			
			str+=escapeHtmlEntities(l[0])+"<br>";
		} else if (l.length==2){
			str+='<a href="#" onclick="goTo(\''+escapeHtmlEntities(l[1])+'\');return false;">'+escapeHtmlEntities(l[0])+'</a><br>';
		}	
	}
	gameArea.innerHTML=str;
}

</script>
</head>
<body onload="init();" dir="auto">
  <h1>my reward</h1>
<div id="gameArea" dir="auto"></div>
<pre>
     -._
         '--._
    .---.     '-..
    )''  `'-      `._
    )c  -'\\         `.
  ,.|\_=/              -._       _.
.' /   (                  ' ,----'|---.
| |  \  )\                  |`-.|     |
|  \ '_.__`---,.____.       |   |     |
| `.= ..,_'\..\..L__//      |   |     |
|         .'._   `--'       |   |     |
\        .'-._\_            '`.,|     |
 `       |    -.`.  _,..,--- `'.-----.'
  \_____,|`-.   \ \.            | | kOs
  | |./| |./ \  ,-.'            | |
  './  './   '...-'            |_._|
</pre>
</body>
</html>
